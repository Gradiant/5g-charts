---
title: Open5GS and srsLTE
--- 

# Open5GS and srsLTE 

4G end to end communication demo with Open5GS and srsRAN.

This setup uses 2 helm charts generated by Gradiant in OpenVerso: `open5gs` and `srs-lte`. These charts are packaged and available at Gradiant's OpenVerso helm repo: https://gradiant.github.io/openverso-charts/

Start by adding the helm repo to your Helm CLI:

```
helm repo add openverso https://gradiant.github.io/openverso-charts/
```

# Deployment EPC and registration of subscribers

First, deploy the EPC (open5gs) using the `epc-values.yaml` file provided in order to overwrite some of the default values of the **Open5GS chart**:

```
helm install open5gs openverso/open5gs --version 1.2.1 --values https://gradiant.github.io/openverso-charts/docs/open5gs-srslte/epc-values.yaml 
```

These new values will:

- Disable the Open5gs NGC, deploying only the components of the Open5gs 4G/5G NSA Core.
- Set the MCC, MNC and TAC to be used by the MME.
- Disable the Ingress for accessing the Open5GS WebUI. 

Once this deployment has been completed, register a subscriber in the EPC by running the script provided, `register_subscriber.sh`:

```
curl -s https://gradiant.github.io/openverso-charts/docs/open5gs-srslte/register_subscriber.sh | bash -s
```
Its execution will manually add the values specified in this script (**IMSI, KI and OPc**) to MongoDB. The changes can be verified following 2 different approaches:

- **Directly through MongoDB**

```
kubectl exec deployment/open5gs-mongodb -ti -- bash

mongo

use open5gs

db.subscribers.find().pretty()
```
- **Using the Open5GS WebUI**: forward a local port to a port on the corresponding Pod by specifying the WebUI Service. Then, the Open5GS WebUI will be available at `localhost:3000`. To do this, execute:
```
kubectl port-forward svc/open5gs-webui 3000:3000
```


# Deployment RAN

Now, deploy the RAN (srs-lte) using the `lte-values.yaml` file provided in order to overwrite some of the default values of the **srs-lte chart**:

```
helm install srs-lte openverso/srs-lte --version 0.1.2 --values https://gradiant.github.io/openverso-charts/docs/open5gs-srslte/lte-values.yaml 
```

Thus, this deployment will not only launch the **eNodeB** and connect it to the Open5GS EPC, but it will also enable the launching of **1 UE**.

It is important to notice that the default values of **MCC, MNC, and TAC** set for the eNB match those configured in the **open5gs** chart. Also, the **IMSI, KI and OPc** given for the UE match the ones provided in `register_subscriber.sh`.

In addition, take into account that the value given for ***enb.mme*** must match the name of the MME service deployed by the open5gs chart. Therefore, in case you use a differente release name for the open5gs chart, make sure that this value is set accordingly. 


# Verify deployment

## Connection between PGW-C and PGW-U (C-Plane and U-Plane of EPC)

Check that the PGW-C (SMF component) gets associated with the PGW-U's (UPF component) address:
```
kubectl logs deployment/open5gs-smf -f
```

## Connection between MME and eNodeB

Check that the MME accepts and adds the eNodeB:
```
kubectl logs deployment/open5gs-mme -f
```

## UE's connectivity

Check that the eNodeB senses UE's presence and the UE gets connected to the network:
```
kubectl logs srs-lte-srs-lte-0 enb -f
```
![UE connectd to eNodeB](https://raw.githubusercontent.com/Gradiant/openverso-charts/gh-pages/docs/open5gs-srslte/screenshots/enb_ue_connected.png "UE connected to eNodeB")

Check that the UE got successfully attached to the network:
 ```
kubectl logs srs-lte-srs-lte-0 ue -f
```
![UE attached to network](https://raw.githubusercontent.com/Gradiant/openverso-charts/gh-pages/docs/open5gs-srslte/screenshots/ue_attached.png "UE attached to network")

Hence, check that the UE created a tunnel interface (`tun_srsue`):
```
kubectl exec srs-lte-srs-lte-0 -c ue -ti -- bash

ip addr
```

![UE's tunnel interface](https://raw.githubusercontent.com/Gradiant/openverso-charts/gh-pages/docs/open5gs-srslte/screenshots/tun_interface_ue.png "UE's tunnel interface")

Check that the UE has connectivity through this interface:
```
ping gradiant.org -I tun_srsue
```
![UEs connectivity](https://raw.githubusercontent.com/Gradiant/openverso-charts/gh-pages/docs/open5gs-srslte/screenshots/ping_ue.png "UEs connectivity")

Moreover, if using `traceroute`, check that the first hop is `10.45.0.1` (PGW-U's side of the tunnel created):
```
traceroute google.com -i tun_srsue
```
![UEs connectivity](https://raw.githubusercontent.com/Gradiant/openverso-charts/gh-pages/docs/open5gs-srslte/screenshots/traceroute_ue.png "UEs connectivity")

Therefore, the UE's traffic can be captured in the PGW-U (UPF). The installation of **tcpdump** in the corresponding pod is needed in order to complete this check:
```
kubectl exec open5gs-upf-0 -ti -- bash

apt update && apt install tcpdump

tcpdump -i ogstun
```
![Capturing traffic in the PGW-U](https://raw.githubusercontent.com/Gradiant/openverso-charts/gh-pages/docs/open5gs-srslte/screenshots/tcpdump.png "Capturing traffic in the PGW-U")

# Clean
Clean the deployment for this demo by uninstalling the 2 helm charts previously installed:
```
helm uninstall srs-lte

helm uninstall open5gs
```